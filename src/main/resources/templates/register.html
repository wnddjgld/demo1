<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>íšŒì›ê°€ì…</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        /* ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .check-msg {
            font-size: 12px;
            margin-top: 5px;
            font-weight: 600;
        }
    </style>
</head>
<body>
<div class="container">
    <header class="header">
        <div class="header-content">
            <h1>ğŸ“ ê³¼ì œ ì œì¶œ ì‹œìŠ¤í…œ</h1>
        </div>
    </header>

    <div style="max-width: 800px; margin: 0 auto;">
        <h2 style="text-align: center; margin-bottom: 40px;">íšŒì›ê°€ì…</h2>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
            <div class="form-container">
                <h3 style="color: #667eea; text-align: center; margin-bottom: 20px;">ğŸ‘¨â€ğŸ“ í•™ìƒ ê°€ì…</h3>
                <p style="text-align: center; color: #666; margin-bottom: 25px;">ê°€ì… ì¦‰ì‹œ ì´ìš© ê°€ëŠ¥</p>
                <form method="post" action="/register/student" onsubmit="return validateForm('student')">
                    <div class="form-group">
                        <label for="student_username">ì•„ì´ë””</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="student_username" name="username" required placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="flex-grow: 1;">
                            <button type="button" class="btn btn-secondary" onclick="checkUsername('student')">ì¤‘ë³µí™•ì¸</button>
                        </div>
                        <p id="student_username_msg" class="check-msg"></p>
                    </div>
                    <div class="form-group">
                        <label for="student_password">ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="student_password" name="password" required placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label for="student_name">ì´ë¦„</label>
                        <input type="text" id="student_name" name="name" required placeholder="ì‹¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <button type="submit" class="btn" style="width: 100%;">í•™ìƒìœ¼ë¡œ ê°€ì…</button>
                </form>
            </div>

            <div class="form-container">
                <h3 style="color: #e74c3c; text-align: center; margin-bottom: 20px;">ğŸ‘¨â€ğŸ« êµìˆ˜ ê°€ì…</h3>
                <p style="text-align: center; color: #666; margin-bottom: 25px;">ê´€ë¦¬ì ìŠ¹ì¸ í›„ ì´ìš© ê°€ëŠ¥</p>
                <form method="post" action="/register/prof" onsubmit="return validateForm('prof')">
                    <div class="form-group">
                        <label for="prof_username">ì•„ì´ë””</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="prof_username" name="username" required placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="flex-grow: 1;">
                            <button type="button" class="btn btn-secondary" onclick="checkUsername('prof')">ì¤‘ë³µí™•ì¸</button>
                        </div>
                        <p id="prof_username_msg" class="check-msg"></p>
                    </div>
                    <div class="form-group">
                        <label for="prof_password">ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="prof_password" name="password" required placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label for="prof_name">ì´ë¦„</label>
                        <input type="text" id="prof_name" name="name" required placeholder="ì‹¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <button type="submit" class="btn btn-danger" style="width: 100%;">êµìˆ˜ ê°€ì… ì‹ ì²­</button>
                </form>
            </div>
        </div>

        <div style="text-align: center; margin-top: 40px;">
            <p>ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a href="/login" style="color: #667eea;">ë¡œê·¸ì¸í•˜ê¸°</a></p>
        </div>
    </div>
</div>

<script>
    // ì¤‘ë³µ í™•ì¸ ìƒíƒœë¥¼ ì¶”ì í•˜ëŠ” ë³€ìˆ˜
    let isStudentUsernameChecked = false;
    let isProfUsernameChecked = false;

    // ì•„ì´ë”” ì…ë ¥ë€ì— ë‚´ìš©ì´ ë³€ê²½ë˜ë©´, ì¤‘ë³µ í™•ì¸ ìƒíƒœë¥¼ ë¦¬ì…‹
    document.getElementById('student_username').addEventListener('input', () => {
        isStudentUsernameChecked = false;
        document.getElementById('student_username_msg').innerText = '';
    });
    document.getElementById('prof_username').addEventListener('input', () => {
        isProfUsernameChecked = false;
        document.getElementById('prof_username_msg').innerText = '';
    });

    // ì¤‘ë³µ í™•ì¸ í•¨ìˆ˜
    async function checkUsername(type) {
        const usernameInput = document.getElementById(type + '_username');
        const msgElement = document.getElementById(type + '_username_msg');
        const username = usernameInput.value;

        if (!username) {
            msgElement.innerText = 'ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
            msgElement.style.color = 'red';
            return;
        }

        try {
            // ì„œë²„ APIì— ì•„ì´ë””ë¥¼ ë³´ë‚´ ì¤‘ë³µ ì—¬ë¶€ í™•ì¸
            const response = await fetch(`/api/check-username?username=${encodeURIComponent(username)}`);
            const data = await response.json();

            if (data.available) {
                msgElement.innerText = 'ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì•„ì´ë”” ì…ë‹ˆë‹¤.';
                msgElement.style.color = 'green';
                if (type === 'student') isStudentUsernameChecked = true;
                if (type === 'prof') isProfUsernameChecked = true;
            } else {
                msgElement.innerText = 'ì´ë¯¸ ì‚¬ìš©ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.';
                msgElement.style.color = 'red';
                if (type === 'student') isStudentUsernameChecked = false;
                if (type === 'prof') isProfUsernameChecked = false;
            }
        } catch (error) {
            msgElement.innerText = 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
            msgElement.style.color = 'red';
        }
    }

    // í¼ ì œì¶œ ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜
    function validateForm(type) {
        if (type === 'student') {
            if (!isStudentUsernameChecked) {
                alert('í•™ìƒ ì•„ì´ë”” ì¤‘ë³µí™•ì¸ì„ í•´ì£¼ì„¸ìš”.');
                return false; // í¼ ì œì¶œ ë°©ì§€
            }
        }
        if (type === 'prof') {
            if (!isProfUsernameChecked) {
                alert('êµìˆ˜ ì•„ì´ë”” ì¤‘ë³µí™•ì¸ì„ í•´ì£¼ì„¸ìš”.');
                return false; // í¼ ì œì¶œ ë°©ì§€
            }
        }
        return true; // í¼ ì œì¶œ í—ˆìš©
    }
</script>

</body>
</html>